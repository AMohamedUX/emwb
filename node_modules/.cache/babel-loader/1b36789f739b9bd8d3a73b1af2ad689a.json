{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from) {\n  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) to[j] = from[i];\n\n  return to;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ActionSetWithChildren = exports.ActionSet = void 0;\n\nvar types_1 = require(\"../client/types\");\n\nvar collection_1 = require(\"../util/collection\");\n\nvar Error_1 = require(\"./Error\");\n\nvar types_2 = require(\"./types\");\n\nvar uuid_1 = __importDefault(require(\"./uuid\"));\n\nvar helper_1 = require(\"./helper\");\n\nvar ActionSet =\n/** @class */\nfunction () {\n  function ActionSet(app, type, group, id) {\n    var _this = this;\n\n    this.app = app;\n    this.type = type;\n    this.group = group;\n    this.subgroups = [];\n    this.subscriptions = [];\n\n    if (!app) {\n      Error_1.throwError(Error_1.Action.INVALID_ACTION, 'Missing required `app`');\n    }\n\n    this.id = id || uuid_1.default();\n    this.defaultGroup = group;\n    var defaultSet = this.set;\n\n    this.set = function () {\n      var _a;\n\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      if (!_this.app.hooks) {\n        return defaultSet.apply(_this, args);\n      }\n\n      return (_a = _this.app.hooks).run.apply(_a, __spreadArray([types_1.LifecycleHook.UpdateAction, defaultSet, _this], args));\n    };\n  }\n\n  ActionSet.prototype.set = function () {\n    var _ = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      _[_i] = arguments[_i];\n    }\n  };\n\n  Object.defineProperty(ActionSet.prototype, \"component\", {\n    get: function () {\n      return {\n        id: this.id,\n        subgroups: this.subgroups,\n        type: this.type\n      };\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  ActionSet.prototype.updateSubscription = function (subscriptionToRemove, group, subgroups) {\n    var eventType = subscriptionToRemove.eventType,\n        callback = subscriptionToRemove.callback,\n        component = subscriptionToRemove.component;\n    var currentIndex;\n    currentIndex = this.subscriptions.findIndex(function (subscription) {\n      return subscription === subscriptionToRemove;\n    });\n\n    if (currentIndex >= 0) {\n      this.subscriptions[currentIndex].unsubscribe();\n    } else {\n      currentIndex = undefined;\n    }\n\n    this.group = group;\n    this.subgroups = subgroups;\n    Object.assign(component, {\n      subgroups: this.subgroups\n    });\n    return this.subscribe(eventType, callback, component, currentIndex);\n  };\n\n  ActionSet.prototype.error = function (callback) {\n    var _this = this;\n\n    var subscriptionIndices = [];\n    helper_1.forEachInEnum(Error_1.Action, function (eventNameSpace) {\n      // Keep track of subscription index so we can call unsubscribe later\n      // This ensure it will continue to work even when the subscription has been updated\n      subscriptionIndices.push(_this.subscriptions.length);\n\n      _this.subscribe(eventNameSpace, callback);\n    });\n    return function () {\n      var subscriptionsToRemove = subscriptionIndices.map(function (index) {\n        return _this.subscriptions[index];\n      });\n      subscriptionsToRemove.forEach(function (toRemove) {\n        collection_1.removeFromCollection(_this.subscriptions, toRemove, function (removed) {\n          removed.unsubscribe();\n        });\n      });\n    };\n  };\n\n  ActionSet.prototype.subscribe = function (eventName, callback, component, currentIndex) {\n    var _this = this;\n\n    var eventComponent = component || this.component;\n    var eventType = eventName.toUpperCase();\n    var boundedCallback = typeof currentIndex === 'number' ? callback : callback.bind(this);\n    var eventNameSpace;\n\n    if (Error_1.isErrorEventName(eventName)) {\n      eventNameSpace = helper_1.getEventNameSpace(types_2.Group.Error, eventName, __assign(__assign({}, eventComponent), {\n        type: ''\n      }));\n    } else {\n      eventNameSpace = helper_1.getEventNameSpace(this.group, eventName, eventComponent);\n    }\n\n    var unsubscribe = this.app.subscribe(eventNameSpace, boundedCallback, component ? component.id : this.id);\n    var subscription = {\n      eventType: eventType,\n      unsubscribe: unsubscribe,\n      callback: boundedCallback,\n      component: eventComponent,\n      updateSubscribe: function (group, subgroups) {\n        return _this.updateSubscription(subscription, group, subgroups);\n      }\n    };\n\n    if (typeof currentIndex === 'number' && currentIndex >= 0 && currentIndex < this.subscriptions.length) {\n      this.subscriptions[currentIndex] = subscription;\n    } else {\n      this.subscriptions.push(subscription);\n    }\n\n    return unsubscribe;\n  };\n\n  ActionSet.prototype.unsubscribe = function (resetOnly) {\n    if (resetOnly === void 0) {\n      resetOnly = false;\n    }\n\n    unsubscribeActions(this.subscriptions, this.defaultGroup, resetOnly);\n    return this;\n  };\n\n  return ActionSet;\n}();\n\nexports.ActionSet = ActionSet;\n\nvar ActionSetWithChildren =\n/** @class */\nfunction (_super) {\n  __extends(ActionSetWithChildren, _super);\n\n  function ActionSetWithChildren() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.children = [];\n    return _this;\n  }\n\n  ActionSetWithChildren.prototype.unsubscribe = function (unsubscribeChildren, resetParentOnly) {\n    if (unsubscribeChildren === void 0) {\n      unsubscribeChildren = true;\n    }\n\n    if (resetParentOnly === void 0) {\n      resetParentOnly = false;\n    }\n\n    unsubscribeActions(this.subscriptions, this.defaultGroup, resetParentOnly);\n    this.children.forEach(function (child) {\n      if (child instanceof ActionSetWithChildren) {\n        child.unsubscribe(unsubscribeChildren, !unsubscribeChildren);\n      } else {\n        child.unsubscribe(!unsubscribeChildren);\n      }\n    });\n    return this;\n  };\n\n  ActionSetWithChildren.prototype.getChild = function (id) {\n    var childIndex = this.children.findIndex(function (child) {\n      return child.id === id;\n    });\n    return childIndex >= 0 ? this.children[childIndex] : undefined;\n  };\n\n  ActionSetWithChildren.prototype.getChildIndex = function (id) {\n    return this.children.findIndex(function (child) {\n      return child.id === id;\n    });\n  };\n\n  ActionSetWithChildren.prototype.getChildSubscriptions = function (id, eventType) {\n    return this.subscriptions.filter(function (sub) {\n      return sub.component.id === id && (!eventType || eventType === sub.eventType);\n    });\n  };\n\n  ActionSetWithChildren.prototype.addChild = function (child, group, subgroups) {\n    var _this = this;\n\n    var subscriptions = child.subscriptions;\n    var existingChild = this.getChild(child.id); // Add child if it doesn't already exist\n\n    if (!existingChild) {\n      this.children.push(child);\n    }\n\n    if (!subscriptions || group === child.group && subgroups === child.subgroups) {\n      return this;\n    }\n\n    subscriptions.forEach(function (subscription) {\n      var updateSubscribe = subscription.updateSubscribe;\n      updateSubscribe(group, subgroups);\n    }); // Update child's group and subgroups\n\n    Object.assign(child, {\n      group: group,\n      subgroups: subgroups\n    }); // Update child's children subscriptions\n\n    if (child instanceof ActionSetWithChildren) {\n      child.children.forEach(function (childIter) {\n        return _this.addChild(childIter, group, subgroups);\n      });\n    }\n\n    return this;\n  };\n\n  ActionSetWithChildren.prototype.removeChild = function (id) {\n    var _this = this;\n\n    collection_1.removeFromCollection(this.children, this.getChild(id), function () {\n      var toBeRemoved = _this.subscriptions.filter(function (subs) {\n        return subs.component.id === id;\n      });\n\n      toBeRemoved.forEach(function (toRemove) {\n        collection_1.removeFromCollection(_this.subscriptions, toRemove, function (removed) {\n          removed.unsubscribe();\n        });\n      });\n    });\n    return this;\n  };\n\n  ActionSetWithChildren.prototype.subscribeToChild = function (child, eventName, callback) {\n    var _this = this;\n\n    var boundedCallback = callback.bind(this);\n\n    if (eventName instanceof Array) {\n      eventName.forEach(function (eventNameIter) {\n        return _this.subscribeToChild(child, eventNameIter, callback);\n      });\n      return this;\n    }\n\n    if (typeof eventName !== 'string') {\n      return this;\n    }\n\n    var eventType = eventName.toUpperCase();\n    var currentSubscriptions = this.getChildSubscriptions(child.id, eventType);\n\n    if (currentSubscriptions.length > 0) {\n      // Subscription is already there, simply update it\n      currentSubscriptions.forEach(function (subs) {\n        return subs.updateSubscribe(_this.group, child.subgroups);\n      });\n    } else {\n      var childComponent = {\n        id: child.id,\n        subgroups: child.subgroups,\n        type: child.type\n      };\n      this.subscribe(eventType, boundedCallback, childComponent);\n    }\n\n    return this;\n  };\n\n  ActionSetWithChildren.prototype.getUpdatedChildActions = function (newActions, currentActions) {\n    if (newActions.length === 0) {\n      while (currentActions.length > 0) {\n        var action = currentActions.pop();\n\n        if (!action) {\n          break;\n        }\n\n        this.removeChild(action.id);\n      }\n\n      return undefined;\n    } // Only allow unique actions\n\n\n    var uniqueActions = newActions.filter(function (action, index, actionsArr) {\n      return index === actionsArr.indexOf(action);\n    });\n    var newActionIds = uniqueActions.map(function (action) {\n      return action.id;\n    }); // Remove unused actions\n\n    var unusedActions = currentActions.filter(function (action) {\n      return newActionIds.indexOf(action.id) < 0;\n    });\n\n    while (unusedActions.length > 0) {\n      var action = unusedActions.pop();\n\n      if (!action) {\n        break;\n      }\n\n      this.removeChild(action.id);\n    }\n\n    return uniqueActions;\n  };\n\n  return ActionSetWithChildren;\n}(ActionSet);\n\nexports.ActionSetWithChildren = ActionSetWithChildren;\n\nfunction unsubscribeActions(subscriptions, defaultGroup, reassign) {\n  if (reassign === void 0) {\n    reassign = false;\n  }\n\n  subscriptions.forEach(function (subscription) {\n    if (reassign) {\n      var updateSubscribe = subscription.updateSubscribe; // eslint-disable-next-line no-warning-comments\n      // TODO: Support cases where we don't wipe out group and subgroups to defaults\n\n      updateSubscribe(defaultGroup, []);\n    } else {\n      var unsubscribe = subscription.unsubscribe;\n      unsubscribe();\n    }\n  });\n\n  if (!reassign) {\n    subscriptions.length = 0;\n  }\n}","map":{"version":3,"sources":["/Users/ayubmohamed/emwb/node_modules/@shopify/app-bridge/actions/ActionSet.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","__spreadArray","to","from","il","j","__importDefault","mod","__esModule","defineProperty","exports","value","ActionSetWithChildren","ActionSet","types_1","require","collection_1","Error_1","types_2","uuid_1","helper_1","app","type","group","id","_this","subgroups","subscriptions","throwError","Action","INVALID_ACTION","default","defaultGroup","defaultSet","set","_a","args","_i","hooks","run","LifecycleHook","UpdateAction","_","get","enumerable","configurable","updateSubscription","subscriptionToRemove","eventType","callback","component","currentIndex","findIndex","subscription","unsubscribe","undefined","subscribe","error","subscriptionIndices","forEachInEnum","eventNameSpace","push","subscriptionsToRemove","map","index","forEach","toRemove","removeFromCollection","removed","eventName","eventComponent","toUpperCase","boundedCallback","bind","isErrorEventName","getEventNameSpace","Group","Error","updateSubscribe","resetOnly","unsubscribeActions","_super","children","unsubscribeChildren","resetParentOnly","child","getChild","childIndex","getChildIndex","getChildSubscriptions","filter","sub","addChild","existingChild","childIter","removeChild","toBeRemoved","subs","subscribeToChild","eventNameIter","currentSubscriptions","childComponent","getUpdatedChildActions","newActions","currentActions","action","pop","uniqueActions","actionsArr","indexOf","newActionIds","unusedActions","reassign"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from) {\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\n        to[j] = from[i];\n    return to;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ActionSetWithChildren = exports.ActionSet = void 0;\nvar types_1 = require(\"../client/types\");\nvar collection_1 = require(\"../util/collection\");\nvar Error_1 = require(\"./Error\");\nvar types_2 = require(\"./types\");\nvar uuid_1 = __importDefault(require(\"./uuid\"));\nvar helper_1 = require(\"./helper\");\nvar ActionSet = /** @class */ (function () {\n    function ActionSet(app, type, group, id) {\n        var _this = this;\n        this.app = app;\n        this.type = type;\n        this.group = group;\n        this.subgroups = [];\n        this.subscriptions = [];\n        if (!app) {\n            Error_1.throwError(Error_1.Action.INVALID_ACTION, 'Missing required `app`');\n        }\n        this.id = id || uuid_1.default();\n        this.defaultGroup = group;\n        var defaultSet = this.set;\n        this.set = function () {\n            var _a;\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            if (!_this.app.hooks) {\n                return defaultSet.apply(_this, args);\n            }\n            return (_a = _this.app.hooks).run.apply(_a, __spreadArray([types_1.LifecycleHook.UpdateAction, defaultSet, _this], args));\n        };\n    }\n    ActionSet.prototype.set = function () {\n        var _ = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            _[_i] = arguments[_i];\n        }\n    };\n    Object.defineProperty(ActionSet.prototype, \"component\", {\n        get: function () {\n            return {\n                id: this.id,\n                subgroups: this.subgroups,\n                type: this.type,\n            };\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ActionSet.prototype.updateSubscription = function (subscriptionToRemove, group, subgroups) {\n        var eventType = subscriptionToRemove.eventType, callback = subscriptionToRemove.callback, component = subscriptionToRemove.component;\n        var currentIndex;\n        currentIndex = this.subscriptions.findIndex(function (subscription) { return subscription === subscriptionToRemove; });\n        if (currentIndex >= 0) {\n            this.subscriptions[currentIndex].unsubscribe();\n        }\n        else {\n            currentIndex = undefined;\n        }\n        this.group = group;\n        this.subgroups = subgroups;\n        Object.assign(component, { subgroups: this.subgroups });\n        return this.subscribe(eventType, callback, component, currentIndex);\n    };\n    ActionSet.prototype.error = function (callback) {\n        var _this = this;\n        var subscriptionIndices = [];\n        helper_1.forEachInEnum(Error_1.Action, function (eventNameSpace) {\n            // Keep track of subscription index so we can call unsubscribe later\n            // This ensure it will continue to work even when the subscription has been updated\n            subscriptionIndices.push(_this.subscriptions.length);\n            _this.subscribe(eventNameSpace, callback);\n        });\n        return function () {\n            var subscriptionsToRemove = subscriptionIndices.map(function (index) { return _this.subscriptions[index]; });\n            subscriptionsToRemove.forEach(function (toRemove) {\n                collection_1.removeFromCollection(_this.subscriptions, toRemove, function (removed) {\n                    removed.unsubscribe();\n                });\n            });\n        };\n    };\n    ActionSet.prototype.subscribe = function (eventName, callback, component, currentIndex) {\n        var _this = this;\n        var eventComponent = component || this.component;\n        var eventType = eventName.toUpperCase();\n        var boundedCallback = typeof currentIndex === 'number' ? callback : callback.bind(this);\n        var eventNameSpace;\n        if (Error_1.isErrorEventName(eventName)) {\n            eventNameSpace = helper_1.getEventNameSpace(types_2.Group.Error, eventName, __assign(__assign({}, eventComponent), { type: '' }));\n        }\n        else {\n            eventNameSpace = helper_1.getEventNameSpace(this.group, eventName, eventComponent);\n        }\n        var unsubscribe = this.app.subscribe(eventNameSpace, boundedCallback, component ? component.id : this.id);\n        var subscription = {\n            eventType: eventType,\n            unsubscribe: unsubscribe,\n            callback: boundedCallback,\n            component: eventComponent,\n            updateSubscribe: function (group, subgroups) {\n                return _this.updateSubscription(subscription, group, subgroups);\n            },\n        };\n        if (typeof currentIndex === 'number' &&\n            currentIndex >= 0 &&\n            currentIndex < this.subscriptions.length) {\n            this.subscriptions[currentIndex] = subscription;\n        }\n        else {\n            this.subscriptions.push(subscription);\n        }\n        return unsubscribe;\n    };\n    ActionSet.prototype.unsubscribe = function (resetOnly) {\n        if (resetOnly === void 0) { resetOnly = false; }\n        unsubscribeActions(this.subscriptions, this.defaultGroup, resetOnly);\n        return this;\n    };\n    return ActionSet;\n}());\nexports.ActionSet = ActionSet;\nvar ActionSetWithChildren = /** @class */ (function (_super) {\n    __extends(ActionSetWithChildren, _super);\n    function ActionSetWithChildren() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.children = [];\n        return _this;\n    }\n    ActionSetWithChildren.prototype.unsubscribe = function (unsubscribeChildren, resetParentOnly) {\n        if (unsubscribeChildren === void 0) { unsubscribeChildren = true; }\n        if (resetParentOnly === void 0) { resetParentOnly = false; }\n        unsubscribeActions(this.subscriptions, this.defaultGroup, resetParentOnly);\n        this.children.forEach(function (child) {\n            if (child instanceof ActionSetWithChildren) {\n                child.unsubscribe(unsubscribeChildren, !unsubscribeChildren);\n            }\n            else {\n                child.unsubscribe(!unsubscribeChildren);\n            }\n        });\n        return this;\n    };\n    ActionSetWithChildren.prototype.getChild = function (id) {\n        var childIndex = this.children.findIndex(function (child) { return child.id === id; });\n        return childIndex >= 0 ? this.children[childIndex] : undefined;\n    };\n    ActionSetWithChildren.prototype.getChildIndex = function (id) {\n        return this.children.findIndex(function (child) { return child.id === id; });\n    };\n    ActionSetWithChildren.prototype.getChildSubscriptions = function (id, eventType) {\n        return this.subscriptions.filter(function (sub) { return sub.component.id === id && (!eventType || eventType === sub.eventType); });\n    };\n    ActionSetWithChildren.prototype.addChild = function (child, group, subgroups) {\n        var _this = this;\n        var subscriptions = child.subscriptions;\n        var existingChild = this.getChild(child.id);\n        // Add child if it doesn't already exist\n        if (!existingChild) {\n            this.children.push(child);\n        }\n        if (!subscriptions || (group === child.group && subgroups === child.subgroups)) {\n            return this;\n        }\n        subscriptions.forEach(function (subscription) {\n            var updateSubscribe = subscription.updateSubscribe;\n            updateSubscribe(group, subgroups);\n        });\n        // Update child's group and subgroups\n        Object.assign(child, { group: group, subgroups: subgroups });\n        // Update child's children subscriptions\n        if (child instanceof ActionSetWithChildren) {\n            child.children.forEach(function (childIter) {\n                return _this.addChild(childIter, group, subgroups);\n            });\n        }\n        return this;\n    };\n    ActionSetWithChildren.prototype.removeChild = function (id) {\n        var _this = this;\n        collection_1.removeFromCollection(this.children, this.getChild(id), function () {\n            var toBeRemoved = _this.subscriptions.filter(function (subs) { return subs.component.id === id; });\n            toBeRemoved.forEach(function (toRemove) {\n                collection_1.removeFromCollection(_this.subscriptions, toRemove, function (removed) {\n                    removed.unsubscribe();\n                });\n            });\n        });\n        return this;\n    };\n    ActionSetWithChildren.prototype.subscribeToChild = function (child, eventName, callback) {\n        var _this = this;\n        var boundedCallback = callback.bind(this);\n        if (eventName instanceof Array) {\n            eventName.forEach(function (eventNameIter) { return _this.subscribeToChild(child, eventNameIter, callback); });\n            return this;\n        }\n        if (typeof eventName !== 'string') {\n            return this;\n        }\n        var eventType = eventName.toUpperCase();\n        var currentSubscriptions = this.getChildSubscriptions(child.id, eventType);\n        if (currentSubscriptions.length > 0) {\n            // Subscription is already there, simply update it\n            currentSubscriptions.forEach(function (subs) { return subs.updateSubscribe(_this.group, child.subgroups); });\n        }\n        else {\n            var childComponent = {\n                id: child.id,\n                subgroups: child.subgroups,\n                type: child.type,\n            };\n            this.subscribe(eventType, boundedCallback, childComponent);\n        }\n        return this;\n    };\n    ActionSetWithChildren.prototype.getUpdatedChildActions = function (newActions, currentActions) {\n        if (newActions.length === 0) {\n            while (currentActions.length > 0) {\n                var action = currentActions.pop();\n                if (!action) {\n                    break;\n                }\n                this.removeChild(action.id);\n            }\n            return undefined;\n        }\n        // Only allow unique actions\n        var uniqueActions = newActions.filter(function (action, index, actionsArr) { return index === actionsArr.indexOf(action); });\n        var newActionIds = uniqueActions.map(function (action) { return action.id; });\n        // Remove unused actions\n        var unusedActions = currentActions.filter(function (action) {\n            return newActionIds.indexOf(action.id) < 0;\n        });\n        while (unusedActions.length > 0) {\n            var action = unusedActions.pop();\n            if (!action) {\n                break;\n            }\n            this.removeChild(action.id);\n        }\n        return uniqueActions;\n    };\n    return ActionSetWithChildren;\n}(ActionSet));\nexports.ActionSetWithChildren = ActionSetWithChildren;\nfunction unsubscribeActions(subscriptions, defaultGroup, reassign) {\n    if (reassign === void 0) { reassign = false; }\n    subscriptions.forEach(function (subscription) {\n        if (reassign) {\n            var updateSubscribe = subscription.updateSubscribe;\n            // eslint-disable-next-line no-warning-comments\n            // TODO: Support cases where we don't wipe out group and subgroups to defaults\n            updateSubscribe(defaultGroup, []);\n        }\n        else {\n            var unsubscribe = subscription.unsubscribe;\n            unsubscribe();\n        }\n    });\n    if (!reassign) {\n        subscriptions.length = 0;\n    }\n}\n"]},"metadata":{},"sourceType":"script"}