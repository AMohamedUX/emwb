{"ast":null,"code":"import _asyncToGenerator from \"/Users/ayubmohamed/emwb/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _toConsumableArray from \"/Users/ayubmohamed/emwb/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _slicedToArray from \"/Users/ayubmohamed/emwb/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _regeneratorRuntime from \"/Users/ayubmohamed/emwb/node_modules/@babel/runtime/regenerator/index.js\";\nimport React, { useState, useRef, useEffect, useCallback, Children, useMemo } from 'react';\nimport debounce from 'lodash/debounce';\nimport { useToggle } from '../../utilities/use-toggle.js';\nimport { Key } from '../../types.js';\nimport { scrollable } from '../shared.js';\nimport styles from './Listbox.scss.js';\nimport { useComboboxListbox } from '../../utilities/combobox/hooks.js';\nimport { scrollOptionIntoView } from '../../utilities/listbox/utilities.js';\nimport { ListboxContext, WithinListboxContext } from '../../utilities/listbox/context.js';\nimport { TextOption } from './components/TextOption/TextOption.js';\nimport { Loading } from './components/Loading/Loading.js';\nimport { Section } from './components/Section/Section.js';\nimport { Header } from './components/Header/Header.js';\nimport { Action } from './components/Action/Action.js';\nimport { useUniqueId } from '../../utilities/unique-id/hooks.js';\nimport { KeypressListener } from '../KeypressListener/KeypressListener.js';\nimport { VisuallyHidden } from '../VisuallyHidden/VisuallyHidden.js';\nimport { Option } from './components/Option/Option.js';\nvar AutoSelection;\n\n(function (AutoSelection) {\n  AutoSelection[\"FirstSelected\"] = \"FIRST_SELECTED\";\n  AutoSelection[\"First\"] = \"FIRST\";\n})(AutoSelection || (AutoSelection = {}));\n\nvar OPTION_SELECTOR = '[data-listbox-option]';\nvar OPTION_VALUE_ATTRIBUTE = 'data-listbox-option-value';\nvar OPTION_ACTION_ATTRIBUTE = 'data-listbox-option-action';\nvar OPTION_FOCUS_ATTRIBUTE = 'data-focused';\n\nfunction Listbox(_ref) {\n  var children = _ref.children,\n      _ref$autoSelection = _ref.autoSelection,\n      autoSelection = _ref$autoSelection === void 0 ? AutoSelection.FirstSelected : _ref$autoSelection,\n      enableKeyboardControl = _ref.enableKeyboardControl,\n      accessibilityLabel = _ref.accessibilityLabel,\n      onSelect = _ref.onSelect,\n      onActiveOptionChange = _ref.onActiveOptionChange;\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(),\n      _useState4 = _slicedToArray(_useState3, 2),\n      activeOption = _useState4[0],\n      setActiveOption = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      lazyLoading = _useState6[0],\n      setLazyLoading = _useState6[1];\n\n  var _useState7 = useState([]),\n      _useState8 = _slicedToArray(_useState7, 2),\n      currentOptions = _useState8[0],\n      setCurrentOptions = _useState8[1];\n\n  var _useToggle = useToggle(Boolean(enableKeyboardControl)),\n      keyboardEventsEnabled = _useToggle.value,\n      enableKeyboardEvents = _useToggle.setTrue,\n      disableKeyboardEvents = _useToggle.setFalse;\n\n  var listId = useUniqueId('Listbox');\n  var scrollableRef = useRef(null);\n  var listboxRef = useRef(null);\n\n  var _useComboboxListbox = useComboboxListbox(),\n      listboxId = _useComboboxListbox.listboxId,\n      textFieldLabelId = _useComboboxListbox.textFieldLabelId,\n      textFieldFocused = _useComboboxListbox.textFieldFocused,\n      willLoadMoreOptions = _useComboboxListbox.willLoadMoreOptions,\n      setActiveOptionId = _useComboboxListbox.setActiveOptionId,\n      setListboxId = _useComboboxListbox.setListboxId,\n      onOptionSelected = _useComboboxListbox.onOptionSelected,\n      onKeyToBottom = _useComboboxListbox.onKeyToBottom;\n\n  var inCombobox = Boolean(setActiveOptionId);\n  useEffect(function () {\n    if (setListboxId && !listboxId) {\n      setListboxId(listId);\n    }\n  }, [setListboxId, listboxId, listId]);\n  var getNavigableOptions = useCallback(function () {\n    if (!listboxRef.current) {\n      return [];\n    }\n\n    return _toConsumableArray(new Set(listboxRef.current.querySelectorAll(OPTION_SELECTOR)));\n  }, []);\n  var getFirstNavigableOption = useCallback(function (currentOptions) {\n    var hasSelectedOptions = currentOptions.some(function (option) {\n      return option.getAttribute('aria-selected') === 'true';\n    });\n    var elementIndex = 0;\n    var element = currentOptions.find(function (option, index) {\n      var isInteractable = option.getAttribute('aria-disabled') !== 'true';\n      var isFirstNavigableOption;\n\n      if (hasSelectedOptions && autoSelection === AutoSelection.FirstSelected) {\n        var isSelected = option.getAttribute('aria-selected') === 'true';\n        isFirstNavigableOption = isSelected && isInteractable;\n      } else {\n        isFirstNavigableOption = isInteractable;\n      }\n\n      if (isFirstNavigableOption) elementIndex = index;\n      return isFirstNavigableOption;\n    });\n    if (!element) return;\n    return {\n      element: element,\n      index: elementIndex\n    };\n  }, [autoSelection]);\n  var handleScrollIntoView = useCallback(function (option) {\n    var scrollable = scrollableRef.current;\n\n    if (scrollable) {\n      scrollOptionIntoView(option.element, scrollable);\n    }\n  }, []);\n  var handleScrollIntoViewDebounced = debounce(handleScrollIntoView, 50);\n  var handleKeyToBottom = useCallback(function () {\n    if (onKeyToBottom) {\n      setLazyLoading(true);\n      return Promise.resolve(onKeyToBottom());\n    }\n  }, [onKeyToBottom]);\n  var handleChangeActiveOption = useCallback(function (nextOption) {\n    if (!nextOption) return setActiveOption(undefined);\n    activeOption === null || activeOption === void 0 ? void 0 : activeOption.element.removeAttribute(OPTION_FOCUS_ATTRIBUTE);\n    nextOption.element.setAttribute(OPTION_FOCUS_ATTRIBUTE, 'true');\n    handleScrollIntoViewDebounced(nextOption);\n    setActiveOption(nextOption);\n    setActiveOptionId === null || setActiveOptionId === void 0 ? void 0 : setActiveOptionId(nextOption.domId);\n    onActiveOptionChange === null || onActiveOptionChange === void 0 ? void 0 : onActiveOptionChange(nextOption.value);\n  }, [activeOption, setActiveOptionId, onActiveOptionChange, handleScrollIntoViewDebounced]);\n  var getFormattedOption = useCallback(function (element, index) {\n    return {\n      element: element,\n      index: index,\n      domId: element.id,\n      value: element.getAttribute(OPTION_VALUE_ATTRIBUTE) || '',\n      disabled: element.getAttribute('aria-disabled') === 'true',\n      isAction: element.getAttribute(OPTION_ACTION_ATTRIBUTE) === 'true'\n    };\n  }, []);\n  var resetActiveOption = useCallback(function () {\n    var _nextOption, _nextOption2, _nextOption3;\n\n    var nextOption;\n    var nextOptions = getNavigableOptions();\n    var nextActiveOption = getFirstNavigableOption(nextOptions);\n\n    if (nextOptions.length === 0 && currentOptions.length > 0) {\n      setCurrentOptions(nextOptions);\n      handleChangeActiveOption();\n      return;\n    }\n\n    if (nextActiveOption) {\n      var element = nextActiveOption.element,\n          index = nextActiveOption.index;\n      nextOption = getFormattedOption(element, index);\n    }\n\n    var optionIsAlreadyActive = activeOption !== undefined && ((_nextOption = nextOption) === null || _nextOption === void 0 ? void 0 : _nextOption.domId) === (activeOption === null || activeOption === void 0 ? void 0 : activeOption.domId);\n    var actionContentHasUpdated = (activeOption === null || activeOption === void 0 ? void 0 : activeOption.isAction) && ((_nextOption2 = nextOption) === null || _nextOption2 === void 0 ? void 0 : _nextOption2.isAction) && ((_nextOption3 = nextOption) === null || _nextOption3 === void 0 ? void 0 : _nextOption3.value) !== (activeOption === null || activeOption === void 0 ? void 0 : activeOption.value);\n    var currentValues = currentOptions.map(function (option) {\n      return option.getAttribute(OPTION_VALUE_ATTRIBUTE);\n    });\n    var nextValues = nextOptions.map(function (option) {\n      return option.getAttribute(OPTION_VALUE_ATTRIBUTE);\n    });\n    var listIsUnchanged = nextValues.length === currentValues.length && nextValues.every(function (value, index) {\n      return currentValues[index] === value;\n    });\n\n    if (listIsUnchanged) {\n      if (optionIsAlreadyActive && actionContentHasUpdated) {\n        setCurrentOptions(nextOptions);\n        handleChangeActiveOption(nextOption);\n      }\n\n      return;\n    }\n\n    setCurrentOptions(nextOptions);\n\n    if (lazyLoading) {\n      setLazyLoading(false);\n      return;\n    }\n\n    handleChangeActiveOption(nextOption);\n  }, [lazyLoading, currentOptions, activeOption, getFirstNavigableOption, getNavigableOptions, getFormattedOption, handleChangeActiveOption]);\n  useEffect(function () {\n    if (!loading && children && Children.count(children) > 0) {\n      resetActiveOption();\n    }\n  }, [children, activeOption, loading, resetActiveOption]);\n  useEffect(function () {\n    if (listboxRef.current) {\n      scrollableRef.current = listboxRef.current.closest(scrollable.selector);\n    }\n  }, []);\n  useEffect(function () {\n    if (enableKeyboardControl && !keyboardEventsEnabled) {\n      enableKeyboardEvents();\n    }\n  }, [enableKeyboardControl, keyboardEventsEnabled, enableKeyboardEvents]);\n  var onOptionSelect = useCallback(function (option) {\n    handleChangeActiveOption(option);\n    if (onOptionSelected) onOptionSelected();\n    if (onSelect) onSelect(option.value);\n  }, [handleChangeActiveOption, onSelect, onOptionSelected]);\n  var getNextIndex = useCallback(function (currentIndex, lastIndex, direction) {\n    var nextIndex;\n\n    if (direction === 'down') {\n      if (currentIndex === lastIndex) {\n        nextIndex = willLoadMoreOptions ? currentIndex + 1 : 0;\n      } else {\n        nextIndex = currentIndex + 1;\n      }\n    } else {\n      nextIndex = currentIndex === 0 ? lastIndex : currentIndex - 1;\n    }\n\n    return nextIndex;\n  }, [willLoadMoreOptions]);\n  var getNextValidOption = useCallback( /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(key) {\n      var lastIndex, currentIndex, nextIndex, element, totalOptions, _element, triggerLazyLoad, isDisabled;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              lastIndex = currentOptions.length - 1;\n              currentIndex = (activeOption === null || activeOption === void 0 ? void 0 : activeOption.index) || 0;\n              nextIndex = 0;\n              element = activeOption === null || activeOption === void 0 ? void 0 : activeOption.element;\n              totalOptions = -1;\n\n            case 5:\n              if (!(totalOptions++ < lastIndex)) {\n                _context.next = 20;\n                break;\n              }\n\n              nextIndex = getNextIndex(currentIndex, lastIndex, key);\n              element = currentOptions[nextIndex];\n              triggerLazyLoad = nextIndex >= lastIndex;\n              isDisabled = ((_element = element) === null || _element === void 0 ? void 0 : _element.getAttribute('aria-disabled')) === 'true';\n\n              if (!(triggerLazyLoad && willLoadMoreOptions)) {\n                _context.next = 13;\n                break;\n              }\n\n              _context.next = 13;\n              return handleKeyToBottom();\n\n            case 13:\n              if (!isDisabled) {\n                _context.next = 17;\n                break;\n              }\n\n              currentIndex = nextIndex;\n              element = undefined;\n              return _context.abrupt(\"continue\", 5);\n\n            case 17:\n              return _context.abrupt(\"break\", 20);\n\n            case 20:\n              return _context.abrupt(\"return\", {\n                element: element,\n                nextIndex: nextIndex\n              });\n\n            case 21:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }(), [currentOptions, activeOption, willLoadMoreOptions, getNextIndex, handleKeyToBottom]);\n  var handleArrow = useCallback( /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(type, event) {\n      var _yield$getNextValidOp, element, nextIndex, nextOption;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              event.preventDefault();\n              _context2.next = 3;\n              return getNextValidOption(type);\n\n            case 3:\n              _yield$getNextValidOp = _context2.sent;\n              element = _yield$getNextValidOp.element;\n              nextIndex = _yield$getNextValidOp.nextIndex;\n\n              if (element) {\n                _context2.next = 8;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 8:\n              nextOption = getFormattedOption(element, nextIndex);\n              handleChangeActiveOption(nextOption);\n\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x2, _x3) {\n      return _ref3.apply(this, arguments);\n    };\n  }(), [getFormattedOption, getNextValidOption, handleChangeActiveOption]);\n  var handleDownArrow = useCallback(function (event) {\n    handleArrow('down', event);\n  }, [handleArrow]);\n  var handleUpArrow = useCallback(function (event) {\n    handleArrow('up', event);\n  }, [handleArrow]);\n  var handleEnter = useCallback(function (event) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    if (activeOption) {\n      onOptionSelect(activeOption);\n    }\n  }, [activeOption, onOptionSelect]);\n  var handleFocus = useCallback(function () {\n    if (enableKeyboardControl) return;\n    enableKeyboardEvents();\n  }, [enableKeyboardControl, enableKeyboardEvents]);\n  var handleBlur = useCallback(function (event) {\n    event.stopPropagation();\n\n    if (keyboardEventsEnabled) {\n      var nextActiveOption = getFirstNavigableOption(currentOptions);\n\n      if (nextActiveOption) {\n        var element = nextActiveOption.element,\n            index = nextActiveOption.index;\n        var nextOption = getFormattedOption(element, index);\n        handleChangeActiveOption(nextOption);\n      }\n    }\n\n    if (enableKeyboardControl) return;\n    disableKeyboardEvents();\n  }, [enableKeyboardControl, currentOptions, keyboardEventsEnabled, disableKeyboardEvents, getFirstNavigableOption, getFormattedOption, handleChangeActiveOption]);\n  var listeners = keyboardEventsEnabled || textFieldFocused ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(KeypressListener, {\n    keyEvent: \"keydown\",\n    keyCode: Key.DownArrow,\n    handler: handleDownArrow\n  }), /*#__PURE__*/React.createElement(KeypressListener, {\n    keyEvent: \"keydown\",\n    keyCode: Key.UpArrow,\n    handler: handleUpArrow\n  }), /*#__PURE__*/React.createElement(KeypressListener, {\n    keyEvent: \"keydown\",\n    keyCode: Key.Enter,\n    handler: handleEnter\n  })) : null;\n  var listboxContext = useMemo(function () {\n    return {\n      onOptionSelect: onOptionSelect,\n      setLoading: setLoading\n    };\n  }, [onOptionSelect]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, listeners, /*#__PURE__*/React.createElement(VisuallyHidden, null, /*#__PURE__*/React.createElement(\"div\", {\n    \"aria-live\": \"polite\"\n  }, loading ? loading : null)), /*#__PURE__*/React.createElement(ListboxContext.Provider, {\n    value: listboxContext\n  }, /*#__PURE__*/React.createElement(WithinListboxContext.Provider, {\n    value: true\n  }, children ? /*#__PURE__*/React.createElement(\"ul\", {\n    tabIndex: 0,\n    role: \"listbox\",\n    className: styles.Listbox,\n    \"aria-label\": inCombobox ? undefined : accessibilityLabel,\n    \"aria-labelledby\": textFieldLabelId,\n    \"aria-busy\": Boolean(loading),\n    \"aria-activedescendant\": activeOption && activeOption.domId,\n    id: listId,\n    onFocus: inCombobox ? undefined : handleFocus,\n    onBlur: inCombobox ? undefined : handleBlur,\n    ref: listboxRef\n  }, children) : null)));\n}\n\nListbox.Option = Option;\nListbox.TextOption = TextOption;\nListbox.Loading = Loading;\nListbox.Section = Section;\nListbox.Header = Header;\nListbox.Action = Action;\nexport { AutoSelection, Listbox };","map":{"version":3,"sources":["/Users/ayubmohamed/emwb/node_modules/@shopify/polaris/build/esm/components/Listbox/Listbox.js"],"names":["React","useState","useRef","useEffect","useCallback","Children","useMemo","debounce","useToggle","Key","scrollable","styles","useComboboxListbox","scrollOptionIntoView","ListboxContext","WithinListboxContext","TextOption","Loading","Section","Header","Action","useUniqueId","KeypressListener","VisuallyHidden","Option","AutoSelection","OPTION_SELECTOR","OPTION_VALUE_ATTRIBUTE","OPTION_ACTION_ATTRIBUTE","OPTION_FOCUS_ATTRIBUTE","Listbox","children","autoSelection","FirstSelected","enableKeyboardControl","accessibilityLabel","onSelect","onActiveOptionChange","loading","setLoading","activeOption","setActiveOption","lazyLoading","setLazyLoading","currentOptions","setCurrentOptions","Boolean","keyboardEventsEnabled","value","enableKeyboardEvents","setTrue","disableKeyboardEvents","setFalse","listId","scrollableRef","listboxRef","listboxId","textFieldLabelId","textFieldFocused","willLoadMoreOptions","setActiveOptionId","setListboxId","onOptionSelected","onKeyToBottom","inCombobox","getNavigableOptions","current","Set","querySelectorAll","getFirstNavigableOption","hasSelectedOptions","some","option","getAttribute","elementIndex","element","find","index","isInteractable","isFirstNavigableOption","isSelected","handleScrollIntoView","handleScrollIntoViewDebounced","handleKeyToBottom","Promise","resolve","handleChangeActiveOption","nextOption","undefined","removeAttribute","setAttribute","domId","getFormattedOption","id","disabled","isAction","resetActiveOption","_nextOption","_nextOption2","_nextOption3","nextOptions","nextActiveOption","length","optionIsAlreadyActive","actionContentHasUpdated","currentValues","map","nextValues","listIsUnchanged","every","count","closest","selector","onOptionSelect","getNextIndex","currentIndex","lastIndex","direction","nextIndex","getNextValidOption","key","totalOptions","triggerLazyLoad","isDisabled","_element","handleArrow","type","event","preventDefault","handleDownArrow","handleUpArrow","handleEnter","stopPropagation","handleFocus","handleBlur","listeners","createElement","Fragment","keyEvent","keyCode","DownArrow","handler","UpArrow","Enter","listboxContext","Provider","tabIndex","role","className","onFocus","onBlur","ref"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect, useCallback, Children, useMemo } from 'react';\nimport debounce from 'lodash/debounce';\nimport { useToggle } from '../../utilities/use-toggle.js';\nimport { Key } from '../../types.js';\nimport { scrollable } from '../shared.js';\nimport styles from './Listbox.scss.js';\nimport { useComboboxListbox } from '../../utilities/combobox/hooks.js';\nimport { scrollOptionIntoView } from '../../utilities/listbox/utilities.js';\nimport { ListboxContext, WithinListboxContext } from '../../utilities/listbox/context.js';\nimport { TextOption } from './components/TextOption/TextOption.js';\nimport { Loading } from './components/Loading/Loading.js';\nimport { Section } from './components/Section/Section.js';\nimport { Header } from './components/Header/Header.js';\nimport { Action } from './components/Action/Action.js';\nimport { useUniqueId } from '../../utilities/unique-id/hooks.js';\nimport { KeypressListener } from '../KeypressListener/KeypressListener.js';\nimport { VisuallyHidden } from '../VisuallyHidden/VisuallyHidden.js';\nimport { Option } from './components/Option/Option.js';\n\nlet AutoSelection;\n\n(function (AutoSelection) {\n  AutoSelection[\"FirstSelected\"] = \"FIRST_SELECTED\";\n  AutoSelection[\"First\"] = \"FIRST\";\n})(AutoSelection || (AutoSelection = {}));\n\nconst OPTION_SELECTOR = '[data-listbox-option]';\nconst OPTION_VALUE_ATTRIBUTE = 'data-listbox-option-value';\nconst OPTION_ACTION_ATTRIBUTE = 'data-listbox-option-action';\nconst OPTION_FOCUS_ATTRIBUTE = 'data-focused';\nfunction Listbox({\n  children,\n  autoSelection = AutoSelection.FirstSelected,\n  enableKeyboardControl,\n  accessibilityLabel,\n  onSelect,\n  onActiveOptionChange\n}) {\n  const [loading, setLoading] = useState();\n  const [activeOption, setActiveOption] = useState();\n  const [lazyLoading, setLazyLoading] = useState(false);\n  const [currentOptions, setCurrentOptions] = useState([]);\n  const {\n    value: keyboardEventsEnabled,\n    setTrue: enableKeyboardEvents,\n    setFalse: disableKeyboardEvents\n  } = useToggle(Boolean(enableKeyboardControl));\n  const listId = useUniqueId('Listbox');\n  const scrollableRef = useRef(null);\n  const listboxRef = useRef(null);\n  const {\n    listboxId,\n    textFieldLabelId,\n    textFieldFocused,\n    willLoadMoreOptions,\n    setActiveOptionId,\n    setListboxId,\n    onOptionSelected,\n    onKeyToBottom\n  } = useComboboxListbox();\n  const inCombobox = Boolean(setActiveOptionId);\n  useEffect(() => {\n    if (setListboxId && !listboxId) {\n      setListboxId(listId);\n    }\n  }, [setListboxId, listboxId, listId]);\n  const getNavigableOptions = useCallback(() => {\n    if (!listboxRef.current) {\n      return [];\n    }\n\n    return [...new Set(listboxRef.current.querySelectorAll(OPTION_SELECTOR))];\n  }, []);\n  const getFirstNavigableOption = useCallback(currentOptions => {\n    const hasSelectedOptions = currentOptions.some(option => option.getAttribute('aria-selected') === 'true');\n    let elementIndex = 0;\n    const element = currentOptions.find((option, index) => {\n      const isInteractable = option.getAttribute('aria-disabled') !== 'true';\n      let isFirstNavigableOption;\n\n      if (hasSelectedOptions && autoSelection === AutoSelection.FirstSelected) {\n        const isSelected = option.getAttribute('aria-selected') === 'true';\n        isFirstNavigableOption = isSelected && isInteractable;\n      } else {\n        isFirstNavigableOption = isInteractable;\n      }\n\n      if (isFirstNavigableOption) elementIndex = index;\n      return isFirstNavigableOption;\n    });\n    if (!element) return;\n    return {\n      element,\n      index: elementIndex\n    };\n  }, [autoSelection]);\n  const handleScrollIntoView = useCallback(option => {\n    const {\n      current: scrollable\n    } = scrollableRef;\n\n    if (scrollable) {\n      scrollOptionIntoView(option.element, scrollable);\n    }\n  }, []);\n  const handleScrollIntoViewDebounced = debounce(handleScrollIntoView, 50);\n  const handleKeyToBottom = useCallback(() => {\n    if (onKeyToBottom) {\n      setLazyLoading(true);\n      return Promise.resolve(onKeyToBottom());\n    }\n  }, [onKeyToBottom]);\n  const handleChangeActiveOption = useCallback(nextOption => {\n    if (!nextOption) return setActiveOption(undefined);\n    activeOption === null || activeOption === void 0 ? void 0 : activeOption.element.removeAttribute(OPTION_FOCUS_ATTRIBUTE);\n    nextOption.element.setAttribute(OPTION_FOCUS_ATTRIBUTE, 'true');\n    handleScrollIntoViewDebounced(nextOption);\n    setActiveOption(nextOption);\n    setActiveOptionId === null || setActiveOptionId === void 0 ? void 0 : setActiveOptionId(nextOption.domId);\n    onActiveOptionChange === null || onActiveOptionChange === void 0 ? void 0 : onActiveOptionChange(nextOption.value);\n  }, [activeOption, setActiveOptionId, onActiveOptionChange, handleScrollIntoViewDebounced]);\n  const getFormattedOption = useCallback((element, index) => {\n    return {\n      element,\n      index,\n      domId: element.id,\n      value: element.getAttribute(OPTION_VALUE_ATTRIBUTE) || '',\n      disabled: element.getAttribute('aria-disabled') === 'true',\n      isAction: element.getAttribute(OPTION_ACTION_ATTRIBUTE) === 'true'\n    };\n  }, []);\n  const resetActiveOption = useCallback(() => {\n    var _nextOption, _nextOption2, _nextOption3;\n\n    let nextOption;\n    const nextOptions = getNavigableOptions();\n    const nextActiveOption = getFirstNavigableOption(nextOptions);\n\n    if (nextOptions.length === 0 && currentOptions.length > 0) {\n      setCurrentOptions(nextOptions);\n      handleChangeActiveOption();\n      return;\n    }\n\n    if (nextActiveOption) {\n      const {\n        element,\n        index\n      } = nextActiveOption;\n      nextOption = getFormattedOption(element, index);\n    }\n\n    const optionIsAlreadyActive = activeOption !== undefined && ((_nextOption = nextOption) === null || _nextOption === void 0 ? void 0 : _nextOption.domId) === (activeOption === null || activeOption === void 0 ? void 0 : activeOption.domId);\n    const actionContentHasUpdated = (activeOption === null || activeOption === void 0 ? void 0 : activeOption.isAction) && ((_nextOption2 = nextOption) === null || _nextOption2 === void 0 ? void 0 : _nextOption2.isAction) && ((_nextOption3 = nextOption) === null || _nextOption3 === void 0 ? void 0 : _nextOption3.value) !== (activeOption === null || activeOption === void 0 ? void 0 : activeOption.value);\n    const currentValues = currentOptions.map(option => option.getAttribute(OPTION_VALUE_ATTRIBUTE));\n    const nextValues = nextOptions.map(option => option.getAttribute(OPTION_VALUE_ATTRIBUTE));\n    const listIsUnchanged = nextValues.length === currentValues.length && nextValues.every((value, index) => {\n      return currentValues[index] === value;\n    });\n\n    if (listIsUnchanged) {\n      if (optionIsAlreadyActive && actionContentHasUpdated) {\n        setCurrentOptions(nextOptions);\n        handleChangeActiveOption(nextOption);\n      }\n\n      return;\n    }\n\n    setCurrentOptions(nextOptions);\n\n    if (lazyLoading) {\n      setLazyLoading(false);\n      return;\n    }\n\n    handleChangeActiveOption(nextOption);\n  }, [lazyLoading, currentOptions, activeOption, getFirstNavigableOption, getNavigableOptions, getFormattedOption, handleChangeActiveOption]);\n  useEffect(() => {\n    if (!loading && children && Children.count(children) > 0) {\n      resetActiveOption();\n    }\n  }, [children, activeOption, loading, resetActiveOption]);\n  useEffect(() => {\n    if (listboxRef.current) {\n      scrollableRef.current = listboxRef.current.closest(scrollable.selector);\n    }\n  }, []);\n  useEffect(() => {\n    if (enableKeyboardControl && !keyboardEventsEnabled) {\n      enableKeyboardEvents();\n    }\n  }, [enableKeyboardControl, keyboardEventsEnabled, enableKeyboardEvents]);\n  const onOptionSelect = useCallback(option => {\n    handleChangeActiveOption(option);\n    if (onOptionSelected) onOptionSelected();\n    if (onSelect) onSelect(option.value);\n  }, [handleChangeActiveOption, onSelect, onOptionSelected]);\n  const getNextIndex = useCallback((currentIndex, lastIndex, direction) => {\n    let nextIndex;\n\n    if (direction === 'down') {\n      if (currentIndex === lastIndex) {\n        nextIndex = willLoadMoreOptions ? currentIndex + 1 : 0;\n      } else {\n        nextIndex = currentIndex + 1;\n      }\n    } else {\n      nextIndex = currentIndex === 0 ? lastIndex : currentIndex - 1;\n    }\n\n    return nextIndex;\n  }, [willLoadMoreOptions]);\n  const getNextValidOption = useCallback(async key => {\n    const lastIndex = currentOptions.length - 1;\n    let currentIndex = (activeOption === null || activeOption === void 0 ? void 0 : activeOption.index) || 0;\n    let nextIndex = 0;\n    let element = activeOption === null || activeOption === void 0 ? void 0 : activeOption.element;\n    let totalOptions = -1;\n\n    while (totalOptions++ < lastIndex) {\n      var _element;\n\n      nextIndex = getNextIndex(currentIndex, lastIndex, key);\n      element = currentOptions[nextIndex];\n      const triggerLazyLoad = nextIndex >= lastIndex;\n      const isDisabled = ((_element = element) === null || _element === void 0 ? void 0 : _element.getAttribute('aria-disabled')) === 'true';\n\n      if (triggerLazyLoad && willLoadMoreOptions) {\n        await handleKeyToBottom();\n      }\n\n      if (isDisabled) {\n        currentIndex = nextIndex;\n        element = undefined;\n        continue;\n      }\n\n      break;\n    }\n\n    return {\n      element,\n      nextIndex\n    };\n  }, [currentOptions, activeOption, willLoadMoreOptions, getNextIndex, handleKeyToBottom]);\n  const handleArrow = useCallback(async (type, event) => {\n    event.preventDefault();\n    const {\n      element,\n      nextIndex\n    } = await getNextValidOption(type);\n    if (!element) return;\n    const nextOption = getFormattedOption(element, nextIndex);\n    handleChangeActiveOption(nextOption);\n  }, [getFormattedOption, getNextValidOption, handleChangeActiveOption]);\n  const handleDownArrow = useCallback(event => {\n    handleArrow('down', event);\n  }, [handleArrow]);\n  const handleUpArrow = useCallback(event => {\n    handleArrow('up', event);\n  }, [handleArrow]);\n  const handleEnter = useCallback(event => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    if (activeOption) {\n      onOptionSelect(activeOption);\n    }\n  }, [activeOption, onOptionSelect]);\n  const handleFocus = useCallback(() => {\n    if (enableKeyboardControl) return;\n    enableKeyboardEvents();\n  }, [enableKeyboardControl, enableKeyboardEvents]);\n  const handleBlur = useCallback(event => {\n    event.stopPropagation();\n\n    if (keyboardEventsEnabled) {\n      const nextActiveOption = getFirstNavigableOption(currentOptions);\n\n      if (nextActiveOption) {\n        const {\n          element,\n          index\n        } = nextActiveOption;\n        const nextOption = getFormattedOption(element, index);\n        handleChangeActiveOption(nextOption);\n      }\n    }\n\n    if (enableKeyboardControl) return;\n    disableKeyboardEvents();\n  }, [enableKeyboardControl, currentOptions, keyboardEventsEnabled, disableKeyboardEvents, getFirstNavigableOption, getFormattedOption, handleChangeActiveOption]);\n  const listeners = keyboardEventsEnabled || textFieldFocused ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(KeypressListener, {\n    keyEvent: \"keydown\",\n    keyCode: Key.DownArrow,\n    handler: handleDownArrow\n  }), /*#__PURE__*/React.createElement(KeypressListener, {\n    keyEvent: \"keydown\",\n    keyCode: Key.UpArrow,\n    handler: handleUpArrow\n  }), /*#__PURE__*/React.createElement(KeypressListener, {\n    keyEvent: \"keydown\",\n    keyCode: Key.Enter,\n    handler: handleEnter\n  })) : null;\n  const listboxContext = useMemo(() => ({\n    onOptionSelect,\n    setLoading\n  }), [onOptionSelect]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, listeners, /*#__PURE__*/React.createElement(VisuallyHidden, null, /*#__PURE__*/React.createElement(\"div\", {\n    \"aria-live\": \"polite\"\n  }, loading ? loading : null)), /*#__PURE__*/React.createElement(ListboxContext.Provider, {\n    value: listboxContext\n  }, /*#__PURE__*/React.createElement(WithinListboxContext.Provider, {\n    value: true\n  }, children ? /*#__PURE__*/React.createElement(\"ul\", {\n    tabIndex: 0,\n    role: \"listbox\",\n    className: styles.Listbox,\n    \"aria-label\": inCombobox ? undefined : accessibilityLabel,\n    \"aria-labelledby\": textFieldLabelId,\n    \"aria-busy\": Boolean(loading),\n    \"aria-activedescendant\": activeOption && activeOption.domId,\n    id: listId,\n    onFocus: inCombobox ? undefined : handleFocus,\n    onBlur: inCombobox ? undefined : handleBlur,\n    ref: listboxRef\n  }, children) : null)));\n}\nListbox.Option = Option;\nListbox.TextOption = TextOption;\nListbox.Loading = Loading;\nListbox.Section = Section;\nListbox.Header = Header;\nListbox.Action = Action;\n\nexport { AutoSelection, Listbox };\n"]},"metadata":{},"sourceType":"module"}